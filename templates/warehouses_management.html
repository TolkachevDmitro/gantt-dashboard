<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∫–ª–∞–¥–∞–º–∏ - Gantt Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }
      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
      }
      .flash-message {
        margin-bottom: 1rem;
        padding: 1rem;
        border-radius: 0.375rem;
        font-weight: 500;
      }
      .flash-success {
        background-color: #d1fae5;
        border: 1px solid #a7f3d0;
        color: #065f46;
      }
      .flash-error {
        background-color: #fee2e2;
        border: 1px solid #fecaca;
        color: #991b1b;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">
              –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∫–ª–∞–¥–∞–º–∏
            </h1>
            <p class="text-gray-600 mt-2">
              –î–æ–¥–∞–≤–∞–Ω–Ω—è, —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–∫–ª–∞–¥—ñ–≤
            </p>
          </div>
          <div class="flex space-x-4">
            <a
              href="{{ url_for('admin') }}"
              class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition duration-200"
            >
              ‚Üê –ù–∞–∑–∞–¥ –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
            </a>
            <button
              id="addWarehouseBtn"
              class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-200"
            >
              ‚ûï –î–æ–¥–∞—Ç–∏ —Å–∫–ª–∞–¥
            </button>
          </div>
        </div>
      </div>

      <!-- Flash Messages -->
      <div id="flashMessages"></div>

      <!-- Search and Filter -->
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex flex-wrap gap-4">
          <div class="flex-1 min-w-64">
            <label
              for="searchInput"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              üîç –ü–æ—à—É–∫ —Å–∫–ª–∞–¥—ñ–≤
            </label>
            <input
              type="text"
              id="searchInput"
              placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Å–∫–ª–∞–¥—É..."
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>
      </div>

      <!-- Warehouses Table -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">üì¶ –°–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥—ñ–≤</h2>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  –ù–∞–∑–≤–∞ —Å–∫–ª–∞–¥—É
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                >
                  –î—ñ—ó
                </th>
              </tr>
            </thead>
            <tbody
              id="warehousesTableBody"
              class="bg-white divide-y divide-gray-200"
            >
              <!-- –°–∫–ª–∞–¥–∏ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ç—É—Ç -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Statistics -->
      <div class="mt-6 bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-blue-50 p-4 rounded-lg">
            <div class="text-blue-600 text-sm font-medium">–í—Å—å–æ–≥–æ —Å–∫–ª–∞–¥—ñ–≤</div>
            <div id="totalWarehouses" class="text-2xl font-bold text-blue-700">
              0
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for Add/Edit Warehouse -->
    <div id="warehouseModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle" class="text-xl font-bold mb-4">–î–æ–¥–∞—Ç–∏ —Å–∫–ª–∞–¥</h2>

        <form id="warehouseForm">
          <div class="mb-4">
            <label
              for="name"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              –ù–∞–∑–≤–∞ —Å–∫–ª–∞–¥—É *
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Å–∫–ª–∞–¥—É"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div class="flex justify-end space-x-3">
            <button
              type="button"
              id="cancelBtn"
              class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition duration-200"
            >
              –°–∫–∞—Å—É–≤–∞—Ç–∏
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200"
            >
              –ó–±–µ—Ä–µ–≥—Ç–∏
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      let warehousesData = [];
      let editMode = false;
      let editingWarehouse = null;

      // DOM elements
      const modal = document.getElementById("warehouseModal");
      const modalTitle = document.getElementById("modalTitle");
      const warehouseForm = document.getElementById("warehouseForm");
      const addWarehouseBtn = document.getElementById("addWarehouseBtn");
      const searchInput = document.getElementById("searchInput");
      const warehousesTableBody = document.getElementById(
        "warehousesTableBody"
      );
      const flashMessages = document.getElementById("flashMessages");
      const closeModal = document.querySelector(".close");
      const cancelBtn = document.getElementById("cancelBtn");
      const totalWarehouses = document.getElementById("totalWarehouses");

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        loadWarehouses();

        // Event listeners
        addWarehouseBtn.addEventListener("click", openAddModal);
        searchInput.addEventListener("input", filterWarehouses);
        warehouseForm.addEventListener("submit", saveWarehouse);
        closeModal.addEventListener("click", closeWarehouseModal);
        cancelBtn.addEventListener("click", closeWarehouseModal);

        // Close modal when clicking outside
        window.addEventListener("click", function (event) {
          if (event.target === modal) {
            closeWarehouseModal();
          }
        });
      });

      // Load warehouses from server
      async function loadWarehouses() {
        try {
          const response = await fetch("/api/warehouses_management");
          if (response.ok) {
            warehousesData = await response.json();
            renderWarehouses();
            updateStatistics();
          } else {
            showFlashMessage("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∫–ª–∞–¥—ñ–≤", "error");
          }
        } catch (error) {
          showFlashMessage("–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º", "error");
        }
      }

      // Render warehouses table
      function renderWarehouses(filteredData = null) {
        const dataToRender = filteredData || warehousesData;
        warehousesTableBody.innerHTML = "";

        if (dataToRender.length === 0) {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td colspan="2" class="px-6 py-4 text-center text-gray-500">
              –°–∫–ª–∞–¥—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
            </td>
          `;
          warehousesTableBody.appendChild(row);
          return;
        }

        dataToRender.forEach((warehouse) => {
          const row = document.createElement("tr");
          row.className = "hover:bg-gray-50";
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${warehouse}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <button onclick="editWarehouse('${warehouse}')" 
                        class="text-blue-600 hover:text-blue-800 mr-3">
                    –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                </button>
                <button onclick="deleteWarehouse('${warehouse}')" 
                        class="text-red-600 hover:text-red-800">
                    –í–∏–¥–∞–ª–∏—Ç–∏
                </button>
            </td>
          `;
          warehousesTableBody.appendChild(row);
        });
      }

      // Filter warehouses
      function filterWarehouses() {
        const searchTerm = searchInput.value.toLowerCase();
        const filteredData = warehousesData.filter((warehouse) =>
          warehouse.toLowerCase().includes(searchTerm)
        );
        renderWarehouses(filteredData);
      }

      // Update statistics
      function updateStatistics() {
        totalWarehouses.textContent = warehousesData.length;
      }

      // Open add modal
      function openAddModal() {
        editMode = false;
        editingWarehouse = null;
        modalTitle.textContent = "–î–æ–¥–∞—Ç–∏ —Å–∫–ª–∞–¥";
        warehouseForm.reset();
        modal.style.display = "block";
      }

      // Edit warehouse
      function editWarehouse(name) {
        editMode = true;
        editingWarehouse = name;
        modalTitle.textContent = "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥";
        document.getElementById("name").value = name;
        modal.style.display = "block";
      }

      // Delete warehouse
      async function deleteWarehouse(name) {
        if (!confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Å–∫–ª–∞–¥ "${name}"?`)) {
          return;
        }

        try {
          const response = await fetch("/api/warehouses_management", {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ name }),
          });

          const result = await response.json();
          if (response.ok) {
            showFlashMessage(result.message, "success");
            loadWarehouses();
          } else {
            showFlashMessage(result.error, "error");
          }
        } catch (error) {
          showFlashMessage("–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–∫–ª–∞–¥—É", "error");
        }
      }

      // Save warehouse
      async function saveWarehouse(event) {
        event.preventDefault();

        const formData = new FormData(warehouseForm);
        const warehouseData = {
          name: formData.get("name").trim(),
        };

        if (editMode) {
          warehouseData.old_name = editingWarehouse;
        }

        try {
          const response = await fetch("/api/warehouses_management", {
            method: editMode ? "PUT" : "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(warehouseData),
          });

          const result = await response.json();
          if (response.ok) {
            showFlashMessage(result.message, "success");
            closeWarehouseModal();
            loadWarehouses();
          } else {
            showFlashMessage(result.error, "error");
          }
        } catch (error) {
          showFlashMessage("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–∫–ª–∞–¥—É", "error");
        }
      }

      // Close modal
      function closeWarehouseModal() {
        modal.style.display = "none";
        warehouseForm.reset();
        editMode = false;
        editingWarehouse = null;
      }

      // Show flash message
      function showFlashMessage(message, type) {
        const alertClass = type === "error" ? "flash-error" : "flash-success";
        const alertDiv = document.createElement("div");
        alertDiv.className = `flash-message ${alertClass}`;
        alertDiv.textContent = message;

        flashMessages.appendChild(alertDiv);

        // Remove message after 5 seconds
        setTimeout(() => {
          if (alertDiv.parentNode) {
            alertDiv.parentNode.removeChild(alertDiv);
          }
        }, 5000);
      }
    </script>
  </body>
</html>
